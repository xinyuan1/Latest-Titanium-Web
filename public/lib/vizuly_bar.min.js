/*! vizuly 08-06-2017 */
vizuly.viz.bar=function(a){function b(){k=t.selection.append("svg").attr("id",t.id).style("overflow","visible").attr("class","vizuly"),q=k.append("rect").attr("class","vz-background"),s=vizuly.core.util.getDefs(v),w=s.append("clipPath").attr("id",t.id+"_plotClipPath").append("rect"),x=s.append("clipPath").attr("id",t.id+"_xClipPath").append("rect"),l=k.append("g").attr("class","vz-bar-viz"),m=l.append("g").attr("class","vz-bottom-axis"),n=l.append("g").attr("class","vz-left-axis").attr("clip-path","url(#"+t.id+"_yClipPath)").append("g"),o=l.append("g").attr("class","vz-plot").attr("clip-path","url(#"+t.id+"_plotClipPath)"),r=o.append("rect").attr("class","vz-plot-background").style("fill","#FFF").style("fill-opacity",.01),t.dispatch.initialize()}function c(){v.validate(),g=vizuly.core.util.size(t.margin,t.width,t.height),i=g.height/t.data[0].length*(1-t.padding),h=i/t.data.length*(1-t.padding),t.layout==vizuly.viz.layout.STACKED&&(j=d3.layout.stack().values(function(a){return a}).x(function(a){return t.y(a)}).y(function(a){return t.x(a)}).out(function(a,b,c){a.x0=b}).order("reverse"))(t.data),t.xScale.domain([0,d3.max(t.data,function(a){return d3.max(a,function(a){return t.x(a)+(t.layout==vizuly.viz.layout.STACKED?a.x0:0)})})]),"string"==typeof t.y(t.data[0][0])?t.yScale.domain(t.data[0].map(function(a){return t.y(a)})):t.yScale.domain([d3.min(t.data[0],function(a){return t.y(a)}),d3.max(t.data[0],function(a){return t.y(a)})]),vizuly.core.util.setRange(t.yScale,0,g.height),vizuly.core.util.setRange(t.xScale,0,g.width),t.xAxis.scale(t.xScale).orient("bottom"),t.yAxis.scale(t.yScale).orient("left"),e(),t.dispatch.measure()}function d(){c(),k.attr("width",t.width).attr("height",t.height),q.attr("width",t.width).attr("height",t.height),w.attr("width",g.width).attr("height",g.height),x.attr("width",g.width).attr("height",t.height-g.height).attr("transform","translate("+(g.left+h*t.padding)+","+g.height+")"),o.style("width",g.width).style("height",g.height).attr("transform","translate("+(g.left+h)+","+g.top+")"),m.attr("transform","translate("+(g.left+h)+","+(g.height+g.top)+")"),n.attr("transform","translate("+(g.left+h-h*t.padding)+","+g.top+")"),r.attr("width",g.width).attr("height",g.height),p=o.selectAll(".vz-bar-group").data(t.data[0]),p.enter().append("g").attr("class","vz-bar-group"),p.exit().remove(),p.each(function(a,b){var c=d3.select(this).selectAll(".vz-bar").data(t.data.map(function(a){return a[b]}));c.enter().append("rect").attr("class","vizuly vz-bar").attr("y",function(a,b){return b*(h+h*t.padding)}).attr("width",0).attr("x",0).on("mouseover",function(a,b){t.dispatch.mouseover(this,a,b)}).on("mouseout",function(a,b){t.dispatch.mouseout(this,a,b)}).on("click",function(a,b){t.dispatch.click(this,a,b)}).on("touch",function(a,b){t.dispatch.touch(this,a,b)}),c.exit().remove(),t.layout==vizuly.viz.layout.STACKED?c.transition().duration(t.duration).attr("y",0).attr("height",i).attr("width",function(a,b){return t.xScale(t.x(a))}).attr("x",function(a,b){return t.xScale(a.x0)}):c.transition().duration(t.duration).attr("y",function(a,b){return b*(h+h*t.padding)}).attr("height",h).attr("width",function(a,b){return t.xScale(t.x(a))}).attr("x",0)}),p.attr("transform",function(a,b){return"translate(0,"+t.yScale(t.y(a))+")"}),m.call(t.xAxis),n.call(t.yAxis),t.dispatch.update()}function e(){t.zoom||(t.zoom=d3.behavior.zoom().scaleExtent([1,10]).on("zoomstart",function(){w.attr("width",g.width),x.attr("width",g.left).attr("height",g.height).attr("transform","translate(0,"+g.top+")"),t.dispatch.zoomstart()}).on("zoom",f),o.call(t.zoom)),t.zoom.scale(1).translate([0,0]),w.attr("width",g.width).attr("height",g.height),x.attr("width",g.left).attr("height",g.height).attr("transform","translate(0,"+(g.top+h*t.padding)+")")}function f(){var a=d3.event?d3.event.translate[1]:t.zoom.translate()[1];a<-(t.zoom.scale()*g.height)+g.height?a=-(t.zoom.scale()*g.height)+g.height:a>0&&(a=0),vizuly.core.util.setRange(t.yScale,0,Math.round(g.height*t.zoom.scale())),p.attr("transform",function(b,c){return"translate(0,"+(a+t.yScale(t.y(b)))+")"}).selectAll(".vz-bar").attr("y",function(a,b){return t.layout==vizuly.viz.layout.STACKED?0:b*(h*t.zoom.scale()+h*t.zoom.scale()*t.padding)}).attr("height",function(a,b){return t.layout==vizuly.viz.layout.STACKED?i*t.zoom.scale():h*t.zoom.scale()}),n.attr("transform","translate("+g.left+","+(g.top+h*t.padding+a)+")"),n.call(t.yAxis),t.dispatch.zoom()}var g,h,i,j,k,l,m,n,o,p,q,r,s,t={},u={data:null,layout:vizuly.viz.layout.CLUSTERED,margin:{top:"10%",bottom:"7%",left:"9%",right:"7%"},duration:500,width:300,height:300,padding:.1,x:null,y:null,xScale:d3.scale.linear(),yScale:d3.scale.ordinal(),xAxis:d3.svg.axis(),yAxis:d3.svg.axis()},v=vizuly.core.component(a,t,u);b(),v.update=function(){return d(),v},t.zoom=null,v.zoom=function(a){return arguments.length?(t.zoom=a,void f()):t.zoom};var w,x;return v};